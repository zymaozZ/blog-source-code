(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{342:function(t,e,r){"use strict";r.r(e);var s=r(4),a=Object(s.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h3",{attrs:{id:"背景"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),r("hr"),t._v(" "),r("p",[t._v("首页的文章列表如下图：")]),t._v(" "),r("img",{attrs:{src:"/Users/mzy/Downloads/1.png",width:"400"}}),t._v(" "),r("p",[t._v("视频文章上线后，希望如果是视频类型的文章，将封面缩略图由静态图转为动态的gif图")]),t._v(" "),r("h3",{attrs:{id:"需求"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[t._v("#")]),t._v(" 需求")]),t._v(" "),r("hr"),t._v(" "),r("ul",[r("li",[t._v("视频文章发布后，自动生成gif封面图")])]),t._v(" "),r("h3",{attrs:{id:"思路和调研"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#思路和调研"}},[t._v("#")]),t._v(" 思路和调研")]),t._v(" "),r("hr"),t._v(" "),r("ul",[r("li",[t._v("每发一篇文章就")]),t._v(" "),r("li",[t._v("视频生成gif图片可以由ffmpeg实现，  基础命令为："),r("code",[t._v("ffmpeg -ss 0 -t 8 -i /video_path.mp4 -r 15 gif_path.gif")]),t._v("。其中 "),r("code",[t._v("-ss time off : set the start time offset")]),t._v("，"),r("code",[t._v('-t duration : record or transcode "duration" seconds of audio/video')]),t._v("，"),r("code",[t._v("-r rate ： set frame rate (Hz value, fraction or abbreviation)")])])]),t._v(" "),r("h3",{attrs:{id:"实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[t._v("#")]),t._v(" 实现")]),t._v(" "),r("hr"),t._v(" "),r("ul",[r("li",[t._v("设计两类 redis的key。一个是视频的"),r("code",[t._v("list")]),t._v("，一个category_id 的"),r("code",[t._v("zset")]),t._v("，每发一篇视频文章就往对应的list:{category_id)中 push 文章id；另一个是 user_id 的"),r("code",[t._v("zset")]),t._v("，"),r("code",[t._v("member")]),t._v(" 为 category_id, "),r("code",[t._v("score")]),t._v(" 为 用户看过的 list:{category_id} 的 offset。用户每次请求视频文章接口，先拿offset，再"),r("code",[t._v("lrange key offset expectedCount")])]),t._v(" "),r("li",[t._v("用户每次请求接口，从redis 的 list:{category_id}中取出10个，并且记录下用户看到了哪里（offset），已看完的置为负数。（没有取够10个时，会用zrangebyscore，找出未看完的offset最小那个category_id，递归继续取。如果全部取完了。就将所有category_id的"),r("code",[t._v("zset")]),t._v("重置回初始状态）")])])])}),[],!1,null,null,null);e.default=a.exports}}]);